<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Movimientos Físicos</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.6.0/math.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --background-color: #ecf0f1;
            --card-color: #ffffff;
            --text-color: #2c3e50;
            --border-color: #bdc3c7;
        }
        
        body {
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 30px 0;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-radius: 0 0 10px 10px;
        }
        
        h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .tab-btn {
            padding: 12px 25px;
            background-color: var(--card-color);
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-color);
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .tab-btn.active {
            background-color: var(--secondary-color);
            color: white;
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }
        
        .tab-content {
            display: none;
            background-color: var(--card-color);
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .input-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            margin-top: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .simulation-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .simulation-container {
                grid-template-columns: 1fr;
            }
        }
        
        .animation-section {
            background-color: #f5f7fa;
            border-radius: 10px;
            padding: 20px;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color);
        }
        
        .animation-title {
            margin-top: 0;
            color: var(--primary-color);
            font-size: 1.3rem;
            margin-bottom: 15px;
        }
        
        .animation-box {
            height: 120px;
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            position: relative;
            margin: 20px 0;
            overflow: hidden;
            background-color: #e8f4fc;
            background-image: linear-gradient(to right, #e8f4fc 1px, transparent 1px);
            background-size: 20px 100%;
        }
        
        .moving-object {
            width: 60px;
            height: 30px;
            position: absolute;
            left: 0;
            bottom: 10px;
            transition: left 0.1s linear;
            background-image: url("auto.png");
            background-size: contain;
            background-repeat: no-repeat;
        }
        
        .road-mark {
            position: absolute;
            bottom: 20px;
            height: 2px;
            background-color: white;
            width: 100%;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            background-color: #f8f9fa;
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }
        
        .time-display {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.1rem;
        }
        
        .graph-section {
            margin-top: 40px;
        }
        
        .graph-container {
            margin-bottom: 30px;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color);
        }
        
        .graph-title {
            margin-top: 0;
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .equations-section {
            background-color: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-top: 40px;
            border-left: 5px solid var(--secondary-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .equations-title {
            margin-top: 0;
            color: var(--primary-color);
            font-size: 1.3rem;
            margin-bottom: 15px;
        }
        
        .equation {
            font-family: 'Courier New', Courier, monospace;
            background-color: white;
            padding: 12px 15px;
            border-radius: 6px;
            margin: 12px 0;
            overflow-x: auto;
            border-left: 3px solid var(--accent-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
            border-top: 1px solid var(--border-color);
        }
        
        /* Estilo para las gráficas */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Visualizador de Movimientos Físicos</h1>
            <p>Explora los diferentes tipos de movimiento con gráficas y animaciones interactivas</p>
        </div>
    </header>
    
    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" data-tab="mru">MRU</button>
            <button class="tab-btn" data-tab="mruv">MRUV</button>
            <button class="tab-btn" data-tab="variado">Movimiento Variado</button>
        </div>
        
        <!-- MRU Tab -->
        <div id="mru" class="tab-content active">
            <div class="input-section">
                <div>
                    <h2>Movimiento Rectilíneo Uniforme</h2>
                    <p>En el MRU, la velocidad es constante y no hay aceleración.</p>
                    
                    <div class="input-group">
                        <label for="mru-velocity">Velocidad (m/s)</label>
                        <input type="number" id="mru-velocity" value="2" step="0.1">
                    </div>
                    
                    <div class="input-group">
                        <label for="mru-time">Tiempo de simulación (s)</label>
                        <input type="number" id="mru-time" value="10" min="1">
                    </div>
                    
                    <button id="mru-simulate">Simular Movimiento</button>
                </div>
                
                <div class="animation-section">
                    <h3 class="animation-title">Animación del MRU</h3>
                    <div class="animation-box" id="mru-animation-box">
                        <div class="moving-object" id="mru-object"></div>
                        <div class="road-mark"></div>
                    </div>
                    <div class="controls">
                        <div class="time-display">Tiempo: <span id="mru-current-time">0</span>s</div>
                        <button id="mru-play-btn">▶️ Reproducir</button>
                    </div>
                </div>
            </div>
            
            <div class="graph-section">
                <h2>Gráficas del MRU</h2>
                
                <div class="graph-container">
                    <h3 class="graph-title">Posición vs Tiempo</h3>
                    <div class="chart-container">
                        <canvas id="mru-pos-chart"></canvas>
                    </div>
                </div>
                
                <div class="graph-container">
                    <h3 class="graph-title">Velocidad vs Tiempo</h3>
                    <div class="chart-container">
                        <canvas id="mru-vel-chart"></canvas>
                    </div>
                </div>
                
                <div class="graph-container">
                    <h3 class="graph-title">Aceleración vs Tiempo</h3>
                    <div class="chart-container">
                        <canvas id="mru-acc-chart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="equations-section">
                <h3 class="equations-title">Ecuaciones del MRU</h3>
                <div class="equation">Posición: x(t) = x₀ + v·t</div>
                <div class="equation">Velocidad: v(t) = v (constante)</div>
                <div class="equation">Aceleración: a(t) = 0</div>
            </div>
        </div>
        
        <!-- MRUV Tab -->
        <div id="mruv" class="tab-content">
            <div class="input-section">
                <div>
                    <h2>Movimiento Rectilíneo Uniformemente Variado</h2>
                    <p>En el MRUV, la aceleración es constante y la velocidad cambia uniformemente.</p>
                    
                    <div class="input-group">
                        <label for="mruv-velocity">Velocidad inicial (m/s)</label>
                        <input type="number" id="mruv-velocity" value="1" step="0.1">
                    </div>
                    
                    <div class="input-group">
                        <label for="mruv-acceleration">Aceleración (m/s²)</label>
                        <input type="number" id="mruv-acceleration" value="0.5" step="0.1">
                    </div>
                    
                    <div class="input-group">
                        <label for="mruv-time">Tiempo de simulación (s)</label>
                        <input type="number" id="mruv-time" value="10" min="1">
                    </div>
                    
                    <button id="mruv-simulate">Simular Movimiento</button>
                </div>
                
                <div class="animation-section">
                    <h3 class="animation-title">Animación del MRUV</h3>
                    <div class="animation-box" id="mruv-animation-box">
                        <div class="moving-object" id="mruv-object"></div>
                        <div class="road-mark"></div>
                    </div>
                    <div class="controls">
                        <div class="time-display">Tiempo: <span id="mruv-current-time">0</span>s</div>
                        <button id="mruv-play-btn">▶️ Reproducir</button>
                    </div>
                </div>
            </div>
            
            <div class="graph-section">
                <h2>Gráficas del MRUV</h2>
                
                <div class="graph-container">
                    <h3 class="graph-title">Posición vs Tiempo</h3>
                    <div class="chart-container">
                        <canvas id="mruv-pos-chart"></canvas>
                    </div>
                </div>
                
                <div class="graph-container">
                    <h3 class="graph-title">Velocidad vs Tiempo</h3>
                    <div class="chart-container">
                        <canvas id="mruv-vel-chart"></canvas>
                    </div>
                </div>
                
                <div class="graph-container">
                    <h3 class="graph-title">Aceleración vs Tiempo</h3>
                    <div class="chart-container">
                        <canvas id="mruv-acc-chart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="equations-section">
                <h3 class="equations-title">Ecuaciones del MRUV</h3>
                <div class="equation">Posición: x(t) = x₀ + v₀·t + ½·a·t²</div>
                <div class="equation">Velocidad: v(t) = v₀ + a·t</div>
                <div class="equation">Aceleración: a(t) = a (constante)</div>
            </div>
        </div>
        
        <!-- Movimiento Variado Tab -->
        <div id="variado" class="tab-content">
            <div class="input-section">
                <div>
                    <h2>Movimiento Variado</h2>
                    <p>En este movimiento, la aceleración puede variar según una función matemática.</p>
                    
                    <div class="input-group">
                        <label for="varied-velocity">Velocidad inicial (m/s)</label>
                        <input type="number" id="varied-velocity" value="0" step="0.1">
                    </div>
                    
                    <div class="input-group">
                        <label for="varied-position">Posición inicial (m)</label>
                        <input type="number" id="varied-position" value="0" step="0.1">
                    </div>
                    
                    <div class="input-group">
                        <label for="varied-acceleration">Aceleración (en función de t)</label>
                        <input type="text" id="varied-acceleration" value="0.5*sin(t)" placeholder="Ej: 0.5, 2*t, sin(t)">
                        <small>Usa 't' como variable tiempo. Ejemplos: 0.5, 2*t, sin(t), t^2</small>
                    </div>
                    
                    <div class="input-group">
                        <label for="varied-time">Tiempo de simulación (s)</label>
                        <input type="number" id="varied-time" value="10" min="1">
                    </div>
                    
                    <button id="varied-simulate">Simular Movimiento</button>
                </div>
                
                <div class="animation-section">
                    <h3 class="animation-title">Animación del Movimiento Variado</h3>
                    <div class="animation-box" id="varied-animation-box">
                        <div class="moving-object" id="varied-object"></div>
                        <div class="road-mark"></div>
                    </div>
                    <div class="controls">
                        <div class="time-display">Tiempo: <span id="varied-current-time">0</span>s</div>
                        <button id="varied-play-btn">▶️ Reproducir</button>
                    </div>
                </div>
            </div>
            
            <div class="graph-section">
                <h2>Gráficas del Movimiento Variado</h2>
                
                <div class="graph-container">
                    <h3 class="graph-title">Posición vs Tiempo</h3>
                    <div class="chart-container">
                        <canvas id="varied-pos-chart"></canvas>
                    </div>
                </div>
                
                <div class="graph-container">
                    <h3 class="graph-title">Velocidad vs Tiempo</h3>
                    <div class="chart-container">
                        <canvas id="varied-vel-chart"></canvas>
                    </div>
                </div>
                
                <div class="graph-container">
                    <h3 class="graph-title">Aceleración vs Tiempo</h3>
                    <div class="chart-container">
                        <canvas id="varied-acc-chart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="equations-section">
                <h3 class="equations-title">Ecuaciones del Movimiento Variado</h3>
                <div class="equation">Posición: Obtenida por integración numérica</div>
                <div class="equation">Velocidad: Obtenida por integración numérica</div>
                <div class="equation">Aceleración: a(t) = <span id="varied-acc-eq">0.5*sin(t)</span></div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>Visualizador de Movimientos Físicos &copy; 2023 | Desarrollado para fines educativos</p>
    </div>

    <script>
        // Tab functionality
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // Remove active class from all buttons and contents
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked button and corresponding content
                btn.classList.add('active');
                const tabId = btn.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        // MRU Simulation
        let mruCharts = {};
        let mruAnimationId = null;
        let mruIsPlaying = false;
        let mruStartTime = null;
        let mruSimulatedData = [];
        
        document.getElementById('mru-simulate').addEventListener('click', simulateMRU);
        document.getElementById('mru-play-btn').addEventListener('click', toggleMRUAnimation);
        
        function simulateMRU() {
            const velocity = parseFloat(document.getElementById('mru-velocity').value);
            const simTime = parseInt(document.getElementById('mru-time').value);
            
            // Generate data
            const timePoints = [];
            const positionPoints = [];
            const velocityPoints = [];
            const accelerationPoints = [];
            
            mruSimulatedData = [];
            
            for (let t = 0; t <= simTime; t += 0.1) {
                timePoints.push(t);
                const position = velocity * t;
                positionPoints.push(position);
                velocityPoints.push(velocity);
                accelerationPoints.push(0);
                
                mruSimulatedData.push({
                    time: t,
                    position: position,
                    velocity: velocity,
                    acceleration: 0
                });
            }
            
            // Create/update charts
            mruCharts.pos = updateChart('mru-pos-chart', 'Posición vs Tiempo', timePoints, positionPoints, 'Posición (m)', mruCharts.pos);
            mruCharts.vel = updateChart('mru-vel-chart', 'Velocidad vs Tiempo', timePoints, velocityPoints, 'Velocidad (m/s)', mruCharts.vel);
            mruCharts.acc = updateChart('mru-acc-chart', 'Aceleración vs Tiempo', timePoints, accelerationPoints, 'Aceleración (m/s²)', mruCharts.acc);
            
            // Reset animation
            resetMRUAnimation();
        }
        
        function resetMRUAnimation() {
            cancelAnimationFrame(mruAnimationId);
            mruIsPlaying = false;
            document.getElementById('mru-object').style.left = '0px';
            document.getElementById('mru-current-time').textContent = '0';
            document.getElementById('mru-play-btn').textContent = '▶️ Reproducir';
            mruStartTime = null;
        }
        
        function toggleMRUAnimation() {
            const btn = document.getElementById('mru-play-btn');
            const simTime = parseFloat(document.getElementById('mru-time').value);
            
            if (!mruIsPlaying) {
                // Start animation
                mruIsPlaying = true;
                btn.textContent = '⏸️ Pausar';
                mruStartTime = performance.now() - (parseFloat(document.getElementById('mru-current-time').textContent) * 1000);
                
                function animateMRU(currentTime) {
                    if (!mruStartTime) mruStartTime = currentTime;
                    
                    const elapsed = (currentTime - mruStartTime) / 1000; // in seconds
                    const displayTime = Math.min(elapsed, simTime);
                    
                    // Update time display
                    document.getElementById('mru-current-time').textContent = displayTime.toFixed(2);
                    
                    // Find the closest data point
                    const dataPoint = mruSimulatedData.reduce((prev, curr) => 
                        Math.abs(curr.time - displayTime) < Math.abs(prev.time - displayTime) ? curr : prev
                    );
                    
                    // Calculate position in pixels
                    const animationBox = document.getElementById('mru-animation-box');
                    const object = document.getElementById('mru-object');
                    const maxDistance = animationBox.clientWidth - object.clientWidth;
                    const maxPosition = mruSimulatedData[mruSimulatedData.length - 1].position;
                    const pixelPosition = (dataPoint.position / maxPosition) * maxDistance;
                    
                    // Move object
                    object.style.left = `${Math.min(pixelPosition, maxDistance)}px`;
                    
                    // Continue animation if not finished
                    if (elapsed < simTime) {
                        mruAnimationId = requestAnimationFrame(animateMRU);
                    } else {
                        mruIsPlaying = false;
                        btn.textContent = '▶️ Reproducir';
                    }
                }
                
                mruAnimationId = requestAnimationFrame(animateMRU);
            } else {
                // Pause animation
                cancelAnimationFrame(mruAnimationId);
                mruIsPlaying = false;
                btn.textContent = '▶️ Reproducir';
            }
        }
        
        // MRUV Simulation
        let mruvCharts = {};
        let mruvAnimationId = null;
        let mruvIsPlaying = false;
        let mruvStartTime = null;
        let mruvSimulatedData = [];
        
        document.getElementById('mruv-simulate').addEventListener('click', simulateMRUV);
        document.getElementById('mruv-play-btn').addEventListener('click', toggleMRUVAnimation);
        
        function simulateMRUV() {
            const velocity = parseFloat(document.getElementById('mruv-velocity').value);
            const acceleration = parseFloat(document.getElementById('mruv-acceleration').value);
            const simTime = parseInt(document.getElementById('mruv-time').value);
            
            // Generate data
            const timePoints = [];
            const positionPoints = [];
            const velocityPoints = [];
            const accelerationPoints = [];
            
            mruvSimulatedData = [];
            
            for (let t = 0; t <= simTime; t += 0.1) {
                timePoints.push(t);
                const position = velocity * t + 0.5 * acceleration * t * t;
                const currentVelocity = velocity + acceleration * t;
                
                positionPoints.push(position);
                velocityPoints.push(currentVelocity);
                accelerationPoints.push(acceleration);
                
                mruvSimulatedData.push({
                    time: t,
                    position: position,
                    velocity: currentVelocity,
                    acceleration: acceleration
                });
            }
            
            // Create/update charts
            mruvCharts.pos = updateChart('mruv-pos-chart', 'Posición vs Tiempo', timePoints, positionPoints, 'Posición (m)', mruvCharts.pos);
            mruvCharts.vel = updateChart('mruv-vel-chart', 'Velocidad vs Tiempo', timePoints, velocityPoints, 'Velocidad (m/s)', mruvCharts.vel);
            mruvCharts.acc = updateChart('mruv-acc-chart', 'Aceleración vs Tiempo', timePoints, accelerationPoints, 'Aceleración (m/s²)', mruvCharts.acc);
            
            // Reset animation
            resetMRUVAnimation();
        }
        
        function resetMRUVAnimation() {
            cancelAnimationFrame(mruvAnimationId);
            mruvIsPlaying = false;
            document.getElementById('mruv-object').style.left = '0px';
            document.getElementById('mruv-current-time').textContent = '0';
            document.getElementById('mruv-play-btn').textContent = '▶️ Reproducir';
            mruvStartTime = null;
        }
        
        function toggleMRUVAnimation() {
            const btn = document.getElementById('mruv-play-btn');
            const simTime = parseFloat(document.getElementById('mruv-time').value);
            
            if (!mruvIsPlaying) {
                // Start animation
                mruvIsPlaying = true;
                btn.textContent = '⏸️ Pausar';
                mruvStartTime = performance.now() - (parseFloat(document.getElementById('mruv-current-time').textContent) * 1000);
                
                function animateMRUV(currentTime) {
                    if (!mruvStartTime) mruvStartTime = currentTime;
                    
                    const elapsed = (currentTime - mruvStartTime) / 1000; // in seconds
                    const displayTime = Math.min(elapsed, simTime);
                    
                    // Update time display
                    document.getElementById('mruv-current-time').textContent = displayTime.toFixed(2);
                    
                    // Find the closest data point
                    const dataPoint = mruvSimulatedData.reduce((prev, curr) => 
                        Math.abs(curr.time - displayTime) < Math.abs(prev.time - displayTime) ? curr : prev
                    );
                    
                    // Calculate position in pixels
                    const animationBox = document.getElementById('mruv-animation-box');
                    const object = document.getElementById('mruv-object');
                    const maxDistance = animationBox.clientWidth - object.clientWidth;
                    const maxPosition = mruvSimulatedData[mruvSimulatedData.length - 1].position;
                    const pixelPosition = (dataPoint.position / maxPosition) * maxDistance;
                    
                    // Move object
                    object.style.left = `${Math.min(pixelPosition, maxDistance)}px`;
                    
                    // Continue animation if not finished
                    if (elapsed < simTime) {
                        mruvAnimationId = requestAnimationFrame(animateMRUV);
                    } else {
                        mruvIsPlaying = false;
                        btn.textContent = '▶️ Reproducir';
                    }
                }
                
                mruvAnimationId = requestAnimationFrame(animateMRUV);
            } else {
                // Pause animation
                cancelAnimationFrame(mruvAnimationId);
                mruvIsPlaying = false;
                btn.textContent = '▶️ Reproducir';
            }
        }
        
        // Varied Motion Simulation
        let variedCharts = {};
        let variedAnimationId = null;
        let variedIsPlaying = false;
        let variedStartTime = null;
        let variedSimulatedData = [];
        
        document.getElementById('varied-simulate').addEventListener('click', simulateVariedMotion);
        document.getElementById('varied-play-btn').addEventListener('click', toggleVariedAnimation);
        
        function simulateVariedMotion() {
            const initialVelocity = parseFloat(document.getElementById('varied-velocity').value);
            const initialPosition = parseFloat(document.getElementById('varied-position').value);
            const accelerationExpr = document.getElementById('varied-acceleration').value;
            const simTime = parseInt(document.getElementById('varied-time').value);
            
            // Update acceleration equation display
            document.getElementById('varied-acc-eq').textContent = accelerationExpr;
            
            // Generate data using numerical integration
            const dt = 0.1;
            const timePoints = [];
            const positionPoints = [initialPosition];
            const velocityPoints = [initialVelocity];
            const accelerationPoints = [];
            
            variedSimulatedData = [{
                time: 0,
                position: initialPosition,
                velocity: initialVelocity,
                acceleration: 0
            }];
            
            try {
                let currentTime = dt;
                let currentPosition = initialPosition;
                let currentVelocity = initialVelocity;
                
                timePoints.push(0);
                accelerationPoints.push(math.evaluate(accelerationExpr, {t: 0}));
                
                while (currentTime <= simTime) {
                    timePoints.push(currentTime);
                    
                    // Calculate current acceleration
                    const currentAcc = math.evaluate(accelerationExpr, {t: currentTime});
                    accelerationPoints.push(currentAcc);
                    
                    // Update velocity (v = v0 + a*dt)
                    currentVelocity += currentAcc * dt;
                    velocityPoints.push(currentVelocity);
                    
                    // Update position (x = x0 + v*dt)
                    currentPosition += currentVelocity * dt;
                    positionPoints.push(currentPosition);
                    
                    variedSimulatedData.push({
                        time: currentTime,
                        position: currentPosition,
                        velocity: currentVelocity,
                        acceleration: currentAcc
                    });
                    
                    currentTime += dt;
                }
                
                // Create/update charts
                variedCharts.pos = updateChart('varied-pos-chart', 'Posición vs Tiempo', timePoints, positionPoints, 'Posición (m)', variedCharts.pos);
                variedCharts.vel = updateChart('varied-vel-chart', 'Velocidad vs Tiempo', timePoints, velocityPoints, 'Velocidad (m/s)', variedCharts.vel);
                variedCharts.acc = updateChart('varied-acc-chart', 'Aceleración vs Tiempo', timePoints, accelerationPoints, 'Aceleración (m/s²)', variedCharts.acc);
                
                // Reset animation
                resetVariedAnimation();
            } catch (error) {
                alert(`Error en la expresión de aceleración: ${error.message}`);
                console.error(error);
            }
        }
        
        function resetVariedAnimation() {
            cancelAnimationFrame(variedAnimationId);
            variedIsPlaying = false;
            document.getElementById('varied-object').style.left = '0px';
            document.getElementById('varied-current-time').textContent = '0';
            document.getElementById('varied-play-btn').textContent = '▶️ Reproducir';
            variedStartTime = null;
        }
        
        function toggleVariedAnimation() {
            const btn = document.getElementById('varied-play-btn');
            const simTime = parseFloat(document.getElementById('varied-time').value);
            
            if (!variedIsPlaying) {
                // Start animation
                variedIsPlaying = true;
                btn.textContent = '⏸️ Pausar';
                variedStartTime = performance.now() - (parseFloat(document.getElementById('varied-current-time').textContent) * 1000);
                
                function animateVaried(currentTime) {
                    if (!variedStartTime) variedStartTime = currentTime;
                    
                    const elapsed = (currentTime - variedStartTime) / 1000; // in seconds
                    const displayTime = Math.min(elapsed, simTime);
                    
                    // Update time display
                    document.getElementById('varied-current-time').textContent = displayTime.toFixed(2);
                    
                    // Find the closest data point
                    const dataPoint = variedSimulatedData.reduce((prev, curr) => 
                        Math.abs(curr.time - displayTime) < Math.abs(prev.time - displayTime) ? curr : prev
                    );
                    
                    // Calculate position in pixels
                    const animationBox = document.getElementById('varied-animation-box');
                    const object = document.getElementById('varied-object');
                    const maxDistance = animationBox.clientWidth - object.clientWidth;
                    
                    // Find min and max position for scaling
                    const minPosition = Math.min(...variedSimulatedData.map(d => d.position));
                    const maxPosition = Math.max(...variedSimulatedData.map(d => d.position));
                    const positionRange = maxPosition - minPosition;
                    
                    // Scale position to animation box (0 to maxDistance)
                    const scaledPosition = positionRange > 0 ? 
                        ((dataPoint.position - minPosition) / positionRange) * maxDistance : 
                        maxDistance / 2;
                    
                    // Move object
                    object.style.left = `${Math.max(0, Math.min(scaledPosition, maxDistance))}px`;
                    
                    // Continue animation if not finished
                    if (elapsed < simTime) {
                        variedAnimationId = requestAnimationFrame(animateVaried);
                    } else {
                        variedIsPlaying = false;
                        btn.textContent = '▶️ Reproducir';
                    }
                }
                
                variedAnimationId = requestAnimationFrame(animateVaried);
            } else {
                // Pause animation
                cancelAnimationFrame(variedAnimationId);
                variedIsPlaying = false;
                btn.textContent = '▶️ Reproducir';
            }
        }
        
        // Helper function to update or create charts
        function updateChart(canvasId, title, labels, data, yLabel, existingChart) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            
            if (existingChart) {
                existingChart.data.labels = labels;
                existingChart.data.datasets[0].data = data;
                existingChart.update();
                return existingChart;
            }
            
            return new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: yLabel,
                        data: data,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 3,
                        pointRadius: 0,
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: title,
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            padding: {
                                top: 10,
                                bottom: 20
                            }
                        },
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Tiempo (s)',
                                font: {
                                    weight: 'bold',
                                    size: 14
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                font: {
                                    size: 12
                                }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: yLabel,
                                font: {
                                    weight: 'bold',
                                    size: 14
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                font: {
                                    size: 12
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'nearest'
                    },
                    animation: {
                        duration: 1000
                    }
                }
            });
        }
        
        // Initialize with MRU simulation
        window.onload = simulateMRU;
    </script>
</body>
</html>
